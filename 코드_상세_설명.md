# Platform Jump Game - 전체 코드 상세 설명

이 문서는 프로젝트의 모든 .c와 .h 파일을 line-by-line으로 설명합니다.

---

## 목차
1. [main.c](#mainc) - 메인 프로그램 및 게임 루프
2. [game.h](#gameh) - 게임 구조체 및 상수 정의
3. [game.c](#gamec) - 게임 로직 구현
4. [graphics.h](#graphicsh) - 그래픽 함수 선언
5. [graphics.c](#graphicsc) - 화면 렌더링 구현
6. [ranking.h](#rankingh) - 랭킹 시스템 구조체
7. [ranking.c](#rankingc) - Min Heap 랭킹 시스템
8. [music.h](#musich) - 사운드 시스템 선언
9. [music.c](#musicc) - BGM 및 효과음 구현

---

## main.c

메인 프로그램 파일로, 게임의 진입점과 메뉴 시스템, 게임 루프를 담당합니다.

```c
#define _CRT_SECURE_NO_WARNINGS
```
**설명**: Visual Studio에서 strcpy, scanf 등의 함수 사용 시 보안 경고를 무시하는 매크로입니다.

```c
#include <stdio.h>
#include <stdlib.h>
#include <conio.h>
#include <windows.h>
#include <time.h>
#include <string.h>
```
**설명**: 필요한 표준 라이브러리를 포함합니다.
- `stdio.h`: 입출력 함수 (printf, scanf)
- `stdlib.h`: 메모리 할당, 시스템 명령 (system)
- `conio.h`: 콘솔 입출력 (_getch, _kbhit)
- `windows.h`: Windows API (Sleep, 콘솔 제어)
- `time.h`: 시간 관련 함수 (난수 시드)
- `string.h`: 문자열 처리 (strcpy, strcmp)

```c
#include "game.h"
#include "graphics.h"
#include "ranking.h"
#include "music.h"
```
**설명**: 프로젝트의 커스텀 헤더 파일들을 포함합니다.

```c
void run();
void showMenu(MinHeap* rankings);
```
**설명**: 함수 선언 (프로토타입). 컴파일러에게 함수의 존재를 미리 알려줍니다.

### showMenu 함수

```c
void showMenu(MinHeap* rankings) {
```
**설명**: 게임 시작 전 메뉴 화면을 표시하는 함수입니다. MinHeap 포인터를 받아 랭킹 조회 기능을 제공합니다.

```c
    int selected = 0;
```
**설명**: 현재 선택된 메뉴 항목 (0: START GAME, 1: VIEW RANKINGS, 2: EXIT)

```c
    while (1) {
```
**설명**: 무한 루프로 메뉴를 계속 표시합니다. 사용자가 선택할 때까지 반복됩니다.

```c
        system("cls");
```
**설명**: 콘솔 화면을 지웁니다 (Windows 명령어).

```c
        setColor(14);
```
**설명**: 텍스트 색상을 노란색(14)으로 설정합니다.

```c
        printf("\n\n");
        printf("   ==========================================\n");
        printf("          PLATFORM JUMP GAME\n");
        printf("   ==========================================\n\n");
```
**설명**: 게임 타이틀을 화면에 출력합니다.

```c
        setColor(15);
```
**설명**: 텍스트 색상을 흰색(15)으로 변경합니다.

```c
        if (selected == 0) {
            setColor(11);
            printf("   >> 1. START GAME\n");
            setColor(15);
            printf("      2. VIEW RANKINGS\n");
            printf("      3. EXIT\n");
        }
```
**설명**: 첫 번째 메뉴가 선택되었을 때, 해당 항목을 하늘색(11)으로 강조 표시하고 '>>' 화살표를 붙입니다.

```c
        else if (selected == 1) {
            setColor(15);
            printf("      1. START GAME\n");
            setColor(11);
            printf("   >> 2. VIEW RANKINGS\n");
            setColor(15);
            printf("      3. EXIT\n");
        }
```
**설명**: 두 번째 메뉴가 선택되었을 때 강조 표시합니다.

```c
        else {
            setColor(15);
            printf("      1. START GAME\n");
            printf("      2. VIEW RANKINGS\n");
            setColor(11);
            printf("   >> 3. EXIT\n");
            setColor(15);
        }
```
**설명**: 세 번째 메뉴가 선택되었을 때 강조 표시합니다.

```c
        printf("\n   Use W/S to navigate, ENTER to select\n");
```
**설명**: 조작 방법을 안내합니다.

```c
        char key = _getch();
```
**설명**: 키보드 입력을 기다립니다. _getch()는 입력을 화면에 표시하지 않고 받습니다.

```c
        if (key == 'w' || key == 'W') {
            selected--;
            if (selected < 0) selected = 2;
        }
```
**설명**: W 키를 누르면 위로 이동합니다. 0보다 작아지면 2(맨 아래)로 순환합니다.

```c
        else if (key == 's' || key == 'S') {
            selected++;
            if (selected > 2) selected = 0;
        }
```
**설명**: S 키를 누르면 아래로 이동합니다. 2보다 커지면 0(맨 위)으로 순환합니다.

```c
        else if (key == 13) {
```
**설명**: Enter 키(ASCII 13)를 눌렀을 때 처리합니다.

```c
            if (selected == 0) {
                return;
            }
```
**설명**: START GAME 선택 시 함수를 종료하고 게임을 시작합니다.

```c
            else if (selected == 1) {
                system("cls");
                displayRankings(rankings, "", 0);
                printf("\n   Press any key to return to menu...\n");
                _getch();
            }
```
**설명**: VIEW RANKINGS 선택 시 랭킹을 표시하고, 아무 키나 누르면 메뉴로 돌아갑니다.

```c
            else {
                exit(0);
            }
```
**설명**: EXIT 선택 시 프로그램을 종료합니다.

### run 함수

```c
void run() {
```
**설명**: 게임의 메인 실행 함수입니다. 게임 초기화부터 종료까지 전체 흐름을 관리합니다.

```c
    GameState game;
    MinHeap rankings;
    char playerName[50];
    int playAgain = 1;
```
**설명**: 필요한 변수들을 선언합니다.
- `game`: 게임 상태 (플레이어, 몬스터, 코인 등 모든 정보)
- `rankings`: 랭킹 데이터 (Min Heap 구조)
- `playerName`: 플레이어 이름 (최대 50자)
- `playAgain`: 재시작 여부 (1: 계속, 0: 종료)

```c
    srand(time(NULL));
```
**설명**: 난수 생성기를 현재 시간으로 초기화합니다. 파티클 효과의 랜덤성을 위해 필요합니다.

```c
    hideCursor();
```
**설명**: 콘솔 커서를 숨겨서 깨끗한 화면을 만듭니다.

```c
    loadRankings(&rankings);
```
**설명**: rankings.txt 파일에서 기존 랭킹 데이터를 읽어와 Min Heap에 저장합니다.

```c
    FILE* fp = fopen("mainstage.wav", "r");
    if (fp == NULL) {
        printf("\n [경고] mainstage.wav 파일을 찾을 수 없습니다! 폴더를 확인하세요.\n");
        _getch();
    } else {
        fclose(fp);
    }
```
**설명**: BGM 파일이 존재하는지 확인합니다. 없으면 경고 메시지를 표시하지만 게임은 계속 진행됩니다.

```c
    while (playAgain) {
```
**설명**: 플레이어가 게임을 다시 시작할 때까지 반복합니다.

```c
        system("cls");
        setColor(14);
        printf("\n\n");
        printf("   ==========================================\n");
        printf("          PLATFORM JUMP GAME\n");
        printf("   ==========================================\n\n");
        setColor(15);
        printf("   Enter your name: ");
        scanf("%s", playerName);
```
**설명**: 플레이어 이름을 입력받습니다.

```c
        showMenu(&rankings);
```
**설명**: 메뉴 화면을 표시합니다. START GAME을 선택하면 다음 코드로 진행됩니다.

```c
        memset(prevBuffer, 0, sizeof(prevBuffer));
        memset(prevColorBuffer, 0, sizeof(prevColorBuffer));
```
**설명**: 더블 버퍼링용 이전 프레임 버퍼를 0으로 초기화합니다. 화면 깜박임 방지를 위해 필요합니다.

```c
        initGame(&game);
```
**설명**: 게임 상태를 초기화합니다 (플레이어, 플랫폼, 몬스터, 코인 등).

```c
        strcpy(game.player.name, playerName);
```
**설명**: 입력받은 플레이어 이름을 게임 상태에 복사합니다.

```c
        playBGM();
```
**설명**: 배경 음악을 재생합니다.

```c
        while (!game.gameOver) {
```
**설명**: 게임 오버가 될 때까지 게임 루프를 실행합니다.

```c
            handleInput(&game);
```
**설명**: 키보드 입력을 처리합니다 (이동, 점프, 재시작 등).

```c
            if (game.stageCleared && _kbhit()) {
                char key = _getch();
                if (key == 'n' || key == 'N') {
                    nextStage(&game);
                }
            }
```
**설명**: 스테이지 클리어 시 N 키를 누르면 다음 스테이지로 진행합니다.

```c
            updatePlayer(&game);
```
**설명**: 플레이어의 위치, 속도, 충돌 등을 업데이트합니다.

```c
            updateEnemies(&game);
```
**설명**: 몬스터의 이동, AI, 플레이어와의 충돌을 처리합니다.

```c
            updateCoins(&game);
```
**설명**: 코인 수집 및 포탈 진입을 확인합니다.

```c
            updateParticles(&game);
```
**설명**: 파티클 효과를 업데이트합니다 (중력 적용, 생명 감소).

```c
            checkGameOver(&game);
```
**설명**: 게임 오버 조건을 확인합니다 (체력 0, 생명 소진, 스테이지 클리어).

```c
            drawGame(&game);
```
**설명**: 게임 화면을 그립니다 (더블 버퍼링).

```c
            updateBGM();
```
**설명**: BGM이 끝나면 자동으로 다시 재생합니다 (무한 반복).

```c
            game.timer++;
```
**설명**: 게임 타이머를 증가시킵니다 (몬스터 AI 등에 사용).

```c
            Sleep(50);
```
**설명**: 50ms 대기 (약 20 FPS). 게임 속도를 조절합니다.

```c
        stopBGM();
```
**설명**: 게임 오버 시 BGM을 정지합니다.

```c
        insertHeap(&rankings, game.player.name, game.player.score);
```
**설명**: 플레이어의 점수를 Min Heap에 삽입합니다. TOP 10에 들면 자동으로 저장됩니다.

```c
        saveRankings(&rankings);
```
**설명**: 랭킹 데이터를 rankings.txt 파일에 저장합니다.

```c
        system("cls");
        setColor(12);
        printf("\n\n");
        printf("   ===================================\n");
        printf("          GAME OVER!\n");
        printf("   ===================================\n");
        setColor(15);
        printf("\n");
        printf("   Player: %s\n", game.player.name);
        printf("   Final Score: %d\n", game.player.score);
        printf("   Coins Collected: %d\n", game.player.coins);
        printf("   Stage Reached: %d\n", game.level);
        printf("\n");
        printf("   Press any key to see rankings...\n");
        _getch();
```
**설명**: 게임 오버 화면을 표시합니다. 플레이어 이름, 최종 점수, 수집한 코인, 도달한 스테이지를 보여줍니다.

```c
        displayRankings(&rankings, game.player.name, game.player.score);
```
**설명**: TOP 10 랭킹을 표시합니다. 현재 플레이어의 기록은 하늘색으로 강조됩니다.

```c
        printf("\n   Play again? (Y/N): ");
        char choice = _getch();
        if (choice != 'y' && choice != 'Y') {
            playAgain = 0;
        }
```
**설명**: 재시작 여부를 묻습니다. Y가 아니면 프로그램을 종료합니다.

```c
int main() {
    run();
    return 0;
}
```
**설명**: 프로그램의 진입점입니다. run() 함수를 호출하여 게임을 시작합니다.

---

## game.h

게임의 모든 구조체, 상수, 함수 선언을 포함하는 헤더 파일입니다.

```c
#ifndef GAME_H
#define GAME_H
```
**설명**: 헤더 가드 시작. 중복 포함을 방지합니다.

```c
#include <stdio.h>
#include <stdlib.h>
#include <conio.h>
#include <windows.h>
#include <time.h>
#include <string.h>
```
**설명**: 필요한 표준 라이브러리를 포함합니다.

### 게임 상수 정의

```c
#define WIDTH 80
```
**설명**: 게임 화면의 가로 크기 (80칸).

```c
#define HEIGHT 25
```
**설명**: 게임 화면의 세로 크기 (25칸).

```c
#define GRAVITY 1
```
**설명**: 중력 가속도. 매 프레임마다 velocityY에 1씩 더해집니다.

```c
#define MAX_ENEMIES 15
```
**설명**: 최대 몬스터 개수 (배열 크기).

```c
#define MAX_COINS 60
```
**설명**: 최대 코인 개수 (히든 스테이지 50개 + 여유).

```c
#define MAX_PLATFORMS 25
```
**설명**: 최대 플랫폼 개수.

```c
#define MAX_PARTICLES 50
```
**설명**: 최대 파티클 개수 (동시에 표시 가능한 효과).

```c
#define JUMP_POWER -3
```
**설명**: 점프 시 초기 수직 속도. 음수는 위쪽 방향입니다.

### 플레이어 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 플레이어의 현재 위치 (x: 가로, y: 세로).

```c
    int velocityY;
```
**설명**: 수직 속도. 양수는 아래, 음수는 위로 이동합니다.

```c
    int velocityX;
```
**설명**: 수평 속도. 양수는 오른쪽, 음수는 왼쪽으로 이동합니다.

```c
    int onGround;
```
**설명**: 지상 상태 여부 (1: 플랫폼 위, 0: 공중).

```c
    int health;
```
**설명**: 현재 체력 (최대 100).

```c
    int score;
```
**설명**: 총 점수 (코인 +50, 몬스터 처치 +100/+150/+200, 스테이지 클리어 +500).

```c
    int coins;
```
**설명**: 수집한 코인 개수.

```c
    int lives;
```
**설명**: 남은 생명 (시작 시 3개).

```c
    int invincible;
```
**설명**: 무적 상태 여부 (1: 무적, 0: 일반).

```c
    int invincibleTimer;
```
**설명**: 무적 시간 카운터 (프레임 단위, 30프레임 = 1.5초).

```c
    char direction;
```
**설명**: 플레이어가 바라보는 방향 ('R': 오른쪽, 'L': 왼쪽).

```c
    char name[50];
} Player;
```
**설명**: 플레이어 이름 (최대 50자).

### 플랫폼 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 플랫폼의 시작 위치.

```c
    int width;
```
**설명**: 플랫폼의 너비 (칸 수).

```c
    int active;
} Platform;
```
**설명**: 활성화 여부 (1: 활성, 0: 비활성).

### 몬스터 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 몬스터의 현재 위치.

```c
    int velocityX;
    int velocityY;
```
**설명**: 몬스터의 이동 속도 (X: 수평, Y: 수직).

```c
    int active;
```
**설명**: 활성화 여부 (0: 죽음, 1: 살아있음).

```c
    int type;
```
**설명**: 몬스터 타입 (0: 일반, 1: 추적, 2: 비행).

```c
    int homingTimer;
```
**설명**: 추적 타이머 (Type 1 전용, 120프레임마다 추적 시작).

```c
    int homingDuration;
```
**설명**: 추적 지속 시간 (Type 1 전용, 80프레임 동안 추적).

```c
    int respawnTimer;
```
**설명**: 리스폰 타이머 (처치 후 100프레임 후 부활).

```c
    int spawnX;
    int spawnY;
} Enemy;
```
**설명**: 리스폰 위치 (원래 위치로 돌아옴).

### 코인 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 코인의 위치.

```c
    int collected;
} Coin;
```
**설명**: 수집 여부 (0: 미수집, 1: 수집됨).

### 포탈 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 포탈의 위치.

```c
    int active;
} Portal;
```
**설명**: 활성화 여부 (히든 스테이지 진입 가능 여부).

### 파티클 구조체

```c
typedef struct {
    int x, y;
```
**설명**: 파티클의 현재 위치.

```c
    int velocityX, velocityY;
```
**설명**: 파티클의 이동 속도 (중력 영향 받음).

```c
    int life;
```
**설명**: 파티클의 남은 생명 (0이 되면 사라짐).

```c
    char symbol;
} Particle;
```
**설명**: 파티클 문자 ('*', '+', '!', '.').

### 게임 상태 구조체

```c
typedef struct {
    Player player;
```
**설명**: 플레이어 정보.

```c
    Platform platforms[MAX_PLATFORMS];
```
**설명**: 플랫폼 배열 (최대 25개).

```c
    Enemy enemies[MAX_ENEMIES];
```
**설명**: 몬스터 배열 (최대 15개).

```c
    Coin coins[MAX_COINS];
```
**설명**: 코인 배열 (최대 60개).

```c
    Particle particles[MAX_PARTICLES];
```
**설명**: 파티클 배열 (최대 50개).

```c
    Portal portal;
```
**설명**: 포탈 정보 (히든 스테이지 진입용).

```c
    int platformCount;
    int enemyCount;
    int coinCount;
    int particleCount;
```
**설명**: 각 요소의 실제 개수.

```c
    int gameOver;
```
**설명**: 게임 오버 여부 (1: 종료, 0: 진행 중).

```c
    int level;
```
**설명**: 현재 스테이지 번호 (1 또는 2).

```c
    int timer;
```
**설명**: 게임 타이머 (프레임 카운터).

```c
    int stageCleared;
```
**설명**: 스테이지 클리어 여부.

```c
    int inHiddenStage;
```
**설명**: 히든 스테이지 진입 여부.

```c
    int hiddenStageTimer;
```
**설명**: 히든 스테이지 제한 시간 (200프레임 = 10초).

```c
    int returnLevel;
} GameState;
```
**설명**: 히든 스테이지에서 돌아갈 원래 스테이지 번호.

### 함수 선언

```c
void initGame(GameState* game);
```
**설명**: 게임 전체를 초기화합니다.

```c
void initPlayer(Player* player);
```
**설명**: 플레이어를 초기화합니다.

```c
void initPlatforms(GameState* game);
```
**설명**: Stage 1 플랫폼을 배치합니다.

```c
void initEnemies(GameState* game);
```
**설명**: Stage 1 몬스터를 배치합니다.

```c
void initCoins(GameState* game);
```
**설명**: Stage 1 코인을 배치합니다.

```c
void updatePlayer(GameState* game);
```
**설명**: 플레이어의 물리 및 충돌을 업데이트합니다.

```c
void updateEnemies(GameState* game);
```
**설명**: 몬스터의 AI 및 충돌을 업데이트합니다.

```c
void updateCoins(GameState* game);
```
**설명**: 코인 수집 및 포탈을 확인합니다.

```c
void updateParticles(GameState* game);
```
**설명**: 파티클 효과를 업데이트합니다.

```c
void handleInput(GameState* game);
```
**설명**: 키보드 입력을 처리합니다.

```c
void checkGameOver(GameState* game);
```
**설명**: 게임 오버 조건을 확인합니다.

```c
void addParticle(GameState* game, int x, int y, char symbol);
```
**설명**: 새로운 파티클을 생성합니다.

```c
void initStage2(GameState* game);
```
**설명**: Stage 2를 초기화합니다.

```c
void nextStage(GameState* game);
```
**설명**: 다음 스테이지로 진행합니다.

```c
void initHiddenStage(GameState* game);
```
**설명**: 히든 스테이지를 초기화합니다.

```c
void returnFromHiddenStage(GameState* game);
```
**설명**: 히든 스테이지에서 원래 스테이지로 돌아갑니다.

```c
#endif
```
**설명**: 헤더 가드 종료.

---

*계속해서 game.c, graphics.h, graphics.c, ranking.h, ranking.c, music.h, music.c 파일의 상세 설명이 이어집니다...*
